<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<script src="static/js/jquery-3.1.0.min.js"></script>
	<script src="static/js/bootstrap.bundle.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js"></script>
	<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
	<link rel="stylesheet" type="text/css" href="static/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
	<link rel="shortcut icon" href="static/logos/favicon.ico" type="image/x-icon">
	<link rel="icon" href="static/logos/favicon.ico" type="image/x-icon">
	<title>Prova Console</title>
</head>
<body>
	<div class=container>
		<form>
		  <div class="form-group">
		    <label for="exampleFormControlFile1">Update CSV</label>
		    <input id="fileInput" type="file" class="form-control-file" id="exampleFormControlFile1" accept=".csv" multiple>
		  </div>
		  <div class="form-group">
		    <label for="json">Product ID</label>
		    <textarea class="form-control" id="productID" rows="1"></textarea>
		  </div>
		</form>
		<div id=output>
		</div>
		<div id=stats>
		</div>
		<canvas id="myChart" width="200" height="200"></canvas>
		<div id=orders>
			<a class="btn btn-primary" href="#" onclick="sendToUnconfirmedBackers()" role="button">Send Reminder Email to Unconfirmed Backers</a>
		</div>
	</div>
</body>
<script src="https://www.gstatic.com/firebasejs/5.4.2/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyDVfbz-9JfRUha9a9O6gv49Q6tdRDNS2OQ",
    authDomain: "prova-llc.firebaseapp.com",
    databaseURL: "https://prova-llc.firebaseio.com",
    projectId: "prova-llc",
    storageBucket: "",
    messagingSenderId: "970130907892"
  };
  firebase.initializeApp(config);
</script>
<script>
	function gup (name) {
		name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
		var regexS = "[\\?&]"+name+"=([^&#]*)";
		var regex = new RegExp(regexS);
		var results = regex.exec(window.location.href);
		if (results == null) {
			return '';
		} else {
			return results[1];
		}
	} // gup() - Get URL Param

	var numBagsArr = [];
	var countriesArr = [];
	firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        // User is signed in.
        var displayName = user.displayName;
        var email = user.email;
        var emailVerified = user.emailVerified;
        var photoURL = user.photoURL;
        var isAnonymous = user.isAnonymous;
        var uid = user.uid;
        var providerData = user.providerData;

        var orderNumber = gup("order")
        var invoiceRef = firebase.database().ref('/orders/'+orderNumber);
        invoiceRef.on('value', function(snapshot) {
       		getUPSQuote()
        });

      } else {
        window.location.replace("login.html");
      }
    });

	function getUPSQuote() {
		var settings = {
		  "async": true,
		  "crossDomain": true,
		  "url": "https://wwwcie.ups.com/rest/Rate",
		  "method": "POST",
		  "headers": {
		    "Content-Type": "application/json",
		    "cache-control": "no-cache",
		    "Postman-Token": "59ce4948-d4e7-48aa-8e2f-001e36290c50"
		  },
		  "processData": false,
		  "data": "\n\n{\n\t\"UPSSecurity\": {\n\t\t\"UsernameToken\":{\n\t\t\t\"Username\":\"jonathandamico\",\n\t\t\t\"Password\":\"Jonathan1928\"\n\t\t},\n\t\t\"ServiceAccessToken\": {\n\t\t\t\"AccessLicenseNumber\":\"AD54FB714B479A68\"\n\t\t}\n\t},\n\t\"RateRequest\": {\n\t\t\"Request\": {\n\t\t\t\"RequestOption\": \"Rate\"\n\t\t}, \"Shipment\": {\n\t\t\t\"Description\": \"Backpacks\",\n\t\t\t\"Shipper\": {\n\t\t\t\t\"Name\": \"Prova Design LLC\",\n\t\t\t\t\"ShipperNumber\":\"VY8825\",\n\t\t\t\t\"Address\": {\n\t\t\t\t\t\"AddressLine\": \"1124 Napoli Drive\",\n\t\t\t\t\t\"City\": \"Pacific Palisades\",\n\t\t\t\t\t\"StateProvinceCode\": \"CA\",\n\t\t\t\t\t\"PostalCode\": \"90272\",\n\t\t\t\t\t\"CountryCode\": \"US\"\n\t\t\t\t}\n\t\t\t}, \"ShipTo\": {\n\t\t\t\t\"Name\": \"Cameron Schiller\",\n\t\t\t\t\"Address\": {\n\t\t\t\t\t\"AddressLine\": \"3021 Rangeview Drive\",\n\t\t\t\t\t\"City\": \"Glendale\",\n\t\t\t\t\t\"StateProvinceCode\": \"CA\",\n\t\t\t\t\t\"PostalCode\": \"91201\",\n\t\t\t\t\t\"CountryCode\": \"US\",\n\t\t\t\t\t\"ResidentialAddressIndicator\": \"True\"\n\t\t\t\t}\n\t\t\t},\"ShipFrom\": {\n\t\t\t\t\"Name\": \"Prova Design LLC\",\n\t\t\t\t\"Address\": {\n\t\t\t\t\t\"AddressLine\": \"1124 Napoli Drive\",\n\t\t\t\t\t\"City\": \"Pacific Palisades\",\n\t\t\t\t\t\"StateProvinceCode\": \"CA\",\n\t\t\t\t\t\"PostalCode\": \"90272\",\n\t\t\t\t\t\"CountryCode\": \"US\"\n\t\t\t\t}\n\t\t\t}, \"PaymentInformation\": { \n\t\t\t\t\"ShipmentCharge\": {\n\t\t\t\t\t\"Type\": \"01\", \n\t\t\t\t\t\"BillShipper\": {\n\t\t\t\t\t\t\"AccountNumber\":\"VY8825\"\n\t\t\t\t\t} \n\t\t\t\t}\n\t\t\t}, \"Service\": {\n\t\t\t\t\"Code\": \"03\"\n\t\t\t},\n\t\t\t\"Package\": {\n\t\t\t\t\"Description\": \"Backpacks\",\n\t\t\t    \"ReferenceNumber\": {\n\t\t\t        \"Value\": \"20\"\n\t\t\t    },\n\t\t\t    \"PackagingType\": {\n\t\t\t        \"Code\": \"02\",\n\t\t\t        \"Description\": \"Customer Supplied\"\n\t\t\t    },\n\t\t\t    \"Packaging\": {\n\t\t\t        \"Code\": \"02\",\n\t\t\t        \"Description\": \"Customer Supplied\"\n\t\t\t    },\n\t\t\t    \"Dimensions\": {\n\t\t\t        \"UnitOfMeasurement\": {\n\t\t\t            \"Code\": \"IN\",\n\t\t\t            \"Description\": \"Inches\"\n\t\t\t        },\n\t\t\t        \"Length\": \"19\",\n\t\t\t        \"Width\": \"12\",\n\t\t\t        \"Height\": \"3\"\n\t\t\t    },\n\t\t\t    \"PackageWeight\": {\n\t\t\t        \"UnitOfMeasurement\": {\n\t\t\t            \"Code\": \"LBS\",\n\t\t\t            \"Description\": \"Pounds\"\n\t\t\t        },\n\t\t\t        \"Weight\": \"1\"\n\t\t\t    }\n\t\t\t}\n\t\t},\n\t\t\"ShipmentRatingOptions\": {\n\t\t\t\"NegotiatedRatesIndicator\": \"*\" \n\t\t}\n\t}\n}"
		}

		$.ajax(settings).done(function (response) {
		  console.log(response);
		});
	}
</script>